---
import Layout from '../layouts/Layout.astro';

if (Astro.request.method === 'POST') {
  try {
    const data = await Astro.request.formData();
    const name: FormDataEntryValue | null = data.get('name');
    const email: FormDataEntryValue | null = data.get('email');
    const topic: FormDataEntryValue | null = data.get('topic');
    const summary: FormDataEntryValue | null = data.get('summary');

    // Check if name has at least 6 characters
    if (name && name.toString().length < 6) {
      throw new Error('Name must be at least 6 characters long');
    }

    // Check if email is valid (you can add more complex validation)
    if (email && !isValidEmail(email.toString())) {
      throw new Error('Invalid email address');
    }

    // Check if topic and summary have at least 6 characters
    if (
      (topic && topic.toString().length < 6) ||
      (summary && summary.toString().length < 6)
    ) {
      throw new Error('Topic and summary must be at least 6 characters long');
    }

    // Retrieve all selected values for checkboxes
    const proposalTypes = data.getAll('proposal-type');

    // Do something with the data
    console.log('Name:', name);
    console.log('Email:', email);
    console.log('Topic:', topic);
    console.log('Summary:', summary);
    console.log('Proposal Types:', proposalTypes);
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
      // Handle the error message, you can display it to the user
    }
  }
}

// Add a simple email validation function
function isValidEmail(email: string | null): boolean {
  // Implement your email validation logic here
  // For simplicity, just check if it contains '@'
  return !!email && email.includes('@');
}
---

<Layout title="Proposal">
  <main>
    <h1>Propose an idea!</h1>
    <h2 class="text-2xl">Have an idea?! Submit it!</h2>
    <h3 class="text-xl">Fill out the form below!</h3>
    <form method="POST">
      <label class="text-l font-semibold"></label>
      Name:
      <input type="text" name="name" required minlength={6} />
      <label class="text-l font-semibold"></label>
      Email:
      <input type="email" name="email" />
      <label class="text-l font-semibold"> Topic: </label>
      <textarea
        id="topic"
        name="topic"
        required
        minlength={6}
        class="rounded-sm w-full"></textarea>
      <label class="text-l font-semibold">
        Summary:{' '}
      </label>
      <textarea
        id="summary"
        name="summary"
        required
        minlength={6}
        rows={5}
        class="rounded-sm w-full"></textarea>
      <div
        class="checkboxes border-t-4 border-b-4 flex items-center justify-start text-left mb-4 gap-5"
      >
        <input
          type="checkbox"
          id="project"
          name="proposal-type"
          value="project"
        />
        <label class="text-l font-semibold">
          {' '}
          Project!{' '}
        </label>
        <br />
        <input type="checkbox" id="talk" name="proposal-type" value="talk" />
        <label class="text-l font-semibold">
          {' '}
          Talk!{' '}
        </label>
        <br />
        <input type="checkbox" id="lab" name="proposal-type" value="lab" />
        <label class="text-l font-semibold">
          {' '}
          Lab!
        </label>
        <br />
      </div>
      <button type="submit" class="bg-black text-white uppercase px-3 py-7">
        Submit
      </button>
    </form>
  </main>
</Layout>;

